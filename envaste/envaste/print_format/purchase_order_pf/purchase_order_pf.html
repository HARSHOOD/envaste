<html lang="en">
  <style>
    .container {
      width: 100%;
      display: flex;
      flex-direction: row; /* changed from column to row */
      border: 1px solid black;
      box-sizing: border-box;
    }

    .address-box,
    .details-box {
      width: 50%;
      padding: 10px;
      box-sizing: border-box;
    }

    .print-format td,
    .print-format th {
      padding: 6px !important;
      font-size: 12px;
    }

    .footer {
      position: fixed;
      bottom: 0;
      width: 100%;
      text-align: center;
    }

    td,
    th {
      border: 1px solid #000;
      text-align: left;
      padding: 8px;
      color: black !important;
    }

    table {
      border-collapse: collapse;
      width: 100%;
      color: black !important;
    }

    .line {
      border-bottom: 3px solid black;
      height: 1px;
      display: block;
    }

    .print-format label {
      display: inline-block !important;
      color: #000;
    }

    .page-break {
      page-break-after: always;
    }

    input[type="checkbox"] {
      border: 1px solid #000;
      margin-left: 3px;
    }
  </style>

  <body>
    <section>
      <!-- Header -->
      <div
        class="logo-img"
        style="display: flex; justify-content: space-between; align-items: flex-end"
      >
        <img
          class="logo"
          src="/assets/envaste/logo/images.png"
          style="margin-top: -25px; height: 98px"
        />
        <span>
          <p style="text-align: end; font-weight: 600">Ex2 to SOP-6 Rev02</p>
          <h1 style="font-size: 28px; margin-top: 0px; font-weight: 700">
            Purchase Order
          </h1>
        </span>
      </div>

      <!-- Address + Details Section -->
      <div class="container">
        <!-- Left box: Address -->
        <div class="address-box" style="border-right: 1px solid black;">
          {% set address = frappe.get_doc("Address", doc.supplier_address) or None %}
          {% if address %}
          <p> {{ address.address_title or "" }}</p>
          <!-- <p><b>Address:</b></p> -->
          <div style="margin-top: 10px">
            {% if address.address_line1 %}
            <p>{{ address.address_line1 }}</p>
            {% endif %}
            {% if address.address_line2 %}
            <p>{{ address.address_line2 }}</p>
            {% endif %}
            {% if address.city %}
            <p>{{ address.city }}</p>
            {% endif %}
            {% if address.pincode %}
            <p>{{ address.pincode }}</p>
            {% endif %}
            {% if address.state %}
            <p>{{ address.state }}</p>
            {% endif %}
            {% if address.country %}
            <p>{{ address.country }}</p>
            {% endif %}
          </div>
          {% endif %}
        </div>

        <!-- Right box: Other details -->
        <div class="details-box">
          {% set p = frappe.get_doc("Address", doc.supplier_address) %}
          
            <p><b>Date:</b> {{ frappe.utils.formatdate(doc.transaction_date, "dd/mm/yyyy") }}</p>
            <p><b>PO No.:</b> {{ doc.name }}</p>
        
          <p><b>Quote:</b> {{ doc.custom_quote or "" }}</p>
          <p><b>Contact Person:</b> {{ doc.contact_display or "" }}</p>
          <p><b>Email:</b> {{ p.email_id or "" }}</p>
          <p><b>Telephone:</b> {{ p.phone or "" }}</p>
          <p><b>Fax:</b> {{ p.fax or "" }}</p>
        </div>
      </div>

      <br />

      <!-- Item Table -->
      <div>
        <table border="1" style="font-size: 12px; margin-top: 19px; width: 100%">
          <tr>
            <th style="text-align: center; width: 7%">Line</th>
            <th style="text-align: center; width: 12%">Item Code</th>
            <th style="text-align: center; width: 10%">Item Rev</th>
            <th style="text-align: center; width: 40%">Description/Specifications</th>
            <th style="text-align: center; width: 12%">Quantity</th>
            <th style="text-align: center; width: 12%">Rate</th>
            <th style="text-align: center; width: 12%">Total</th>
          </tr>

          {% for item in doc.items %}
          <tr>
            <td style="text-align: center">{{ item.idx }}</td>
            <td style="text-align: center">{{ item.item_code or "" }}</td>
            <td style="text-align: center">
              {{ frappe.db.get_value("Item", doc.item_name, "custom_product_ref") or "" }}
            </td>
            {% set single_item = frappe.get_doc("Item", item.item_code) %}
            <td style="text-align: left">
              {{ single_item.custom_description_1 or "" }}
              {{ single_item.custom_description_2 or "" }}
              {{ single_item.custom_description_3 or "" }}
            </td>
            <td style="text-align: center">{{ item.qty or "" }}</td>
            <td style="text-align: center"> {{ doc.currency }} {{ item.rate or "" }}</td>
            <td style="text-align: center"> {{ doc.currency }} {{ item.amount or "" }}</td>
          </tr>
          {% endfor %}
        </table>
      </div>

      <!-- Totals -->
      <div
  style="
    width: 40%;
    float: right;
    margin-top: 2rem;
    border: 1px solid #000; /* thinner clean border */
    box-sizing: border-box;
  "
>
  <table
    style="
      width: 100%;
      border-collapse: collapse;
      font-size: 12px;
      border: none;
    "
  >
    <tr>
      <th
        style="
          text-align: left;
          border-bottom: 1px solid #000;
          padding: 6px;
          width: 50%;
        "
      >
        SUBTOTAL
      </th>
      <td
        style="
          text-align: left; /* left aligned */
          border-bottom: 1px solid #000;
          padding: 6px;
          width: 50%;
        "
      >
        {{ doc.currency }} {{ doc.total or "0" }}
      </td>
    </tr>

    <tr>
      <th
        style="
          text-align: left;
          border-bottom: 1px solid #000;
          padding: 6px;
        "
      >
        VAT TOTAL
      </th>
      <td
        style="
          text-align: left;
          border-bottom: 1px solid #000;
          padding: 6px;
        "
      >
           {{ doc.total_taxes_and_charges or "0" }}
      </td>
    </tr>

    <tr>
      <th
        style="
          text-align: left;
          padding: 6px;
        "
      >
        GRAND TOTAL
      </th>
      <td
        style="
          text-align: left;
          padding: 6px;
          font-weight: bold;
        "
      >
        {{ doc.currency }} {{ doc.grand_total or "0" }}
      </td>
    </tr>
  </table>
</div>

      <br /><br />

      <!-- Footer Notes -->
      <div class="last">
        {% if doc.schedule_date %}
        <p>
          <b>Expected delivery date:</b>
          {{ frappe.utils.formatdate(doc.schedule_date, "dd/mm/yyyy") }}
        </p>
        {% endif %}
        <p><b>VAT Invoice to order of:</b> Envaste Ltd.</p>
        <p><b>Authorised By:</b> Olivier Berc</p>
        <p style="margin-left: 5rem"><b>Executive Director</b></p>

        <br />
        <table>
          <tr>
            <th colspan="10" style="padding-bottom: 100px !important">
              <b>Remarks:</b><p>{{ doc.custom_remarks or "" }}</p> 
            </th>
          </tr>
        </table>
      </div>
    </section>

    <p
      style="
        color: blue;
        font-size: 10px;
        text-align: center;
        position: fixed;
        width: 100%;
        bottom: 20px;
        padding: Left 0;
        font-weight: 400;
      "
    >
      Envaste Ltd, 4th Floor, Maeva Tower Building, Ebène Business Park, Réduit - 72201,
      Mauritius Tel: +230 463 2084 Email: info@envaste.com www.envaste.com
    </p>
  </body>
</html>
